(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"+4bS":function(e,t,s){var r=s("X5Ec");"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};s("aET+")(r,i);r.locals&&(e.exports=r.locals)},"9UwS":function(e,t,s){"use strict";s.r(t);var r=s("nlWZ"),i=s("lYuH");function n(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return o(e,t)}(e))){var t=0,s=function(){};return{s:s,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,n=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return n=e.done,e},e:function(e){a=!0,i=e},f:function(){try{n||null==r.return||r.return()}finally{if(a)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}var a={data:function(){return{PERMISSION_NAME:i.c,getRolesWithPermissionsRequest:{loadStatus:0,data:{}},crudRoleRequest:{loadStatus:0,data:{},form:{role_name:""}}}},computed:{user:function(){return this.$store.get("auth/user")},rolesAndPermissions:function(){return this.$store.get("auth/rolesAndPermissions")},rolesAndPermissionsLoadStatus:function(){return this.$store.get("auth/rolesAndPermissionsLoadStatus")}},methods:{openCreateRoleModal:function(){this.initCreateRoleModal(),this.$refs["create-role-modal"].show()},initCreateRoleModal:function(){this.crudRoleRequest.loadStatus=0,this.crudRoleRequest.data={},this.crudRoleRequest.form={role_name:""}},applyPermissions:function(){var e=this;this.$swal({title:"You sure to apply this role-permission matrix?",text:"This action can't be undone. However you can use administrator account to re-set permissions for all roles.",icon:"warning",showCancelButton:!0,reverseButtons:!0,confirmButtonColor:"#4dbd74",cancelButtonColor:"#a4b7c1",confirmButtonText:"Apply"}).then((function(t){if(t.value){var s,i=new Object,o=n(e.rolesAndPermissions.roles);try{for(o.s();!(s=o.n()).done;){var a=s.value;i[a.name]=[];var l,c=n($("input[id^=r_"+a.id+"]:checked"));try{for(c.s();!(l=c.n()).done;){var d,u=l.value,m=/r_\d+_p_(\d+)/gm.exec(u.id)[1],h=n(e.rolesAndPermissions.permissions);try{for(h.s();!(d=h.n()).done;){var f=d.value;f.id==m&&i[a.name].push(f.name)}}catch(e){h.e(e)}finally{h.f()}}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}e.getRolesWithPermissionsRequest.loadStatus=1,r.a.updateRolesPermissionsMatrix(i).then((function(t){e.getRolesWithPermissionsRequest.data=t.data,e.getRolesWithPermissionsRequest.loadStatus=2,e.$snotify.success("Applied roles-permissions matrix successfully")})).catch((function(t){!t.response||401!=t.response.status&&403!=t.response.status||e.handleInvalidAuthState(t.response.status),e.loadRolesWithPermissions(),e.$snotify.error("Failed to apply roles-permissions matrix")}))}}))},createRole:function(){var e=this;e.crudRoleRequest.loadStatus=1,r.a.createRole(e.crudRoleRequest.form.role_name).then((function(t){e.loadMatrixData(),e.crudRoleRequest.data=t.data,e.crudRoleRequest.loadStatus=2,e.$refs["create-role-modal"].hide(),e.$snotify.success("Created role successfully")})).catch((function(t){!t.response||401!=t.response.status&&403!=t.response.status?(e.crudRoleRequest.loadStatus=3,t&&t.response?(e.crudRoleRequest.data=t.response.data,e.$snotify.error(t.response.data.error?t.response.data.error.message:t.response.data.message)):e.$snotify.error("Network error")):e.handleInvalidAuthState(t.response.status)}))},deleteRole:function(e){var t=this;t.$swal({title:"You sure to delete this role?",text:"This action can't be undone. You might need to set roles for members who were associated with this role.",icon:"warning",showCancelButton:!0,reverseButtons:!0,confirmButtonColor:"#f86c6b",cancelButtonColor:"#a4b7c1",confirmButtonText:"Delete"}).then((function(s){s.value&&(t.crudRoleRequest.loadStatus=1,r.a.deleteRole(e).then((function(e){t.loadMatrixData(),t.crudRoleRequest.data=e.data,t.crudRoleRequest.loadStatus=2,t.$snotify.success("Deleted role successfully")})).catch((function(e){!e.response||401!=e.response.status&&403!=e.response.status?(t.crudRoleRequest.loadStatus=3,e&&e.response?(t.crudRoleRequest.data=e.response.data,t.$snotify.error(e.response.data.error?e.response.data.error.message:e.response.data.message)):t.$snotify.error("Network error")):t.handleInvalidAuthState(e.response.status)})))}))},roleHasPermission:function(e,t){var s,r=!1,i=n(this.getRolesWithPermissionsRequest.data.roles);try{for(i.s();!(s=i.n()).done;){var o=s.value;if(o.id==e){var a,l=n(o.permissions);try{for(l.s();!(a=l.n()).done;){if(a.value.pivot.permission_id==t){r=!0;break}}}catch(e){l.e(e)}finally{l.f()}break}}}catch(e){i.e(e)}finally{i.f()}return r},reload:function(){this.loadMatrixData()},loadMatrixData:function(){this.$store.dispatch("auth/getRolesAndPermissions"),this.loadRolesWithPermissions()},loadRolesWithPermissions:function(){var e=this;e.getRolesWithPermissionsRequest.loadStatus=1,r.a.getRolesWithPermissions().then((function(t){e.getRolesWithPermissionsRequest.data=t.data,e.getRolesWithPermissionsRequest.loadStatus=2})).catch((function(t){!t.response||401!=t.response.status&&403!=t.response.status?(e.getRolesWithPermissionsRequest.data={},e.getRolesWithPermissionsRequest.loadStatus=3):e.handleInvalidAuthState(t.response.status)}))}},created:function(){this.initCreateRoleModal(),this.loadMatrixData()}},l=(s("q+Me"),s("KHd+")),c=Object(l.a)(a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("b-modal",{ref:"create-role-modal",attrs:{id:"create-role-modal","modal-class":"text-left",centered:"",title:"Create new role"},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[s("b-button",{staticClass:"btn btn-action",attrs:{size:"md",variant:"success"},on:{click:function(t){return e.createRole()}}},[s("span",{staticClass:"text-white"},[e._v("Create")])])]},proxy:!0}])},[s("loading",{attrs:{active:1==e.crudRoleRequest.loadStatus}}),e._v(" "),s("b-form-group",[s("label",{attrs:{for:"role_name"}},[e._v("Role name")]),e._v(" "),s("b-form-input",{class:{"border-danger":e.crudRoleRequest.data.validation&&e.crudRoleRequest.data.validation.role_name},attrs:{type:"text",placeholder:"developer"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.createRole(t)}},model:{value:e.crudRoleRequest.form.role_name,callback:function(t){e.$set(e.crudRoleRequest.form,"role_name",t)},expression:"crudRoleRequest.form.role_name"}}),e._v(" "),s("div",{staticClass:"row"},[e.crudRoleRequest.data.validation&&e.crudRoleRequest.data.validation.role_name?s("div",{staticClass:"col-12 invalid-feedback text-left d-block"},[e._v("\n                    "+e._s(e.crudRoleRequest.data.validation.role_name[0])+"\n                ")]):e._e()])],1)],1),e._v(" "),s("b-card",{staticClass:"text-center",attrs:{header:"Roles-Permissions Matrix","header-class":"text-left"}},[s("div",{staticClass:"col-12 text-right pr-0 mb-3"},[e.hasPermission(e.user,e.PERMISSION_NAME.CREATE_ROLES)?s("b-button",{staticClass:"btn btn-action",attrs:{size:"md",variant:"primary"},on:{click:function(t){return e.openCreateRoleModal()}}},[s("span",{staticClass:"text-white"},[e._v("Create Role")])]):e._e()],1),e._v(" "),s("div",{staticClass:"grid-container"},[1==e.rolesAndPermissionsLoadStatus||1==e.getRolesWithPermissionsRequest.loadStatus?s("div",{staticClass:"middle-center",staticStyle:{position:"inherit"}},[s("div",[s("loading",{attrs:{active:!0,"is-full-page":!1}})],1)]):3==e.rolesAndPermissionsLoadStatus||3==e.getRolesWithPermissionsRequest.loadStatus?s("p",{staticClass:"text-center mb-0"},[e._v("Data load error")]):2==e.rolesAndPermissionsLoadStatus&&2==e.getRolesWithPermissionsRequest.loadStatus?[s("div",{staticClass:"grid",staticStyle:{margin:"auto"}},[s("div",{staticClass:"grid-col grid-col--fixed-left"},[s("div",{staticClass:"grid-item grid-item--role-name"},[s("p",{staticClass:"m-0 ml-1 mr-1 text-center",staticStyle:{"line-height":"2.5em","font-size":"large"}},[s("sub",[e._v("permission")]),e._v("\\"),s("sup",[e._v("role")])])]),e._v(" "),e._l(e.rolesAndPermissions.permissions,(function(t){return s("div",{key:t.id,staticClass:"grid-item grid-item--permission-name"},[s("abbr",{attrs:{title:t.name}},[s("p",{staticClass:"m-0 ml-1 mr-1",staticStyle:{"line-height":"3em"}},[e._v(e._s(t.name))])])])}))],2),e._v(" "),e._l(e.rolesAndPermissions.roles,(function(t){return s("div",{key:t.id,staticClass:"grid-col"},[s("div",{staticClass:"grid-item grid-item--role-name"},[s("p",{staticClass:"m-0 ml-1 mr-1 text-center",staticStyle:{"line-height":"3em"}},[e._v("\n                                "+e._s(t.name)+"\n                                "),1!=t.id&&e.hasPermission(e.user,e.PERMISSION_NAME.DELETE_ROLES)?[s("b-button",{staticClass:"btn btn-action",attrs:{size:"sm",variant:"danger"},on:{click:function(s){return e.deleteRole(t.id)}}},[s("i",{staticClass:"fas fa-trash text-white",attrs:{"aria-hidden":"true"}})])]:e._e()],2)]),e._v(" "),e._l(e.rolesAndPermissions.permissions,(function(r){return s("div",{key:r.id,staticClass:"grid-item"},[s("div",{staticClass:"custom-control form-control-lg text-center"},[!e.roleHasPermission(t.id,r.id)||1!=t.id&&e.hasPermission(e.user,e.PERMISSION_NAME.UPDATE_PERMISSIONS)?e.roleHasPermission(t.id,r.id)||1!=t.id&&e.hasPermission(e.user,e.PERMISSION_NAME.UPDATE_PERMISSIONS)?e.roleHasPermission(t.id,r.id)&&e.hasPermission(e.user,e.PERMISSION_NAME.UPDATE_PERMISSIONS)?s("input",{staticClass:"custom-checkbox",attrs:{type:"checkbox",checked:"",id:"r_"+t.id+"_p_"+r.id}}):s("input",{staticClass:"custom-checkbox",attrs:{type:"checkbox",id:"r_"+t.id+"_p_"+r.id}}):s("input",{staticClass:"custom-checkbox",attrs:{type:"checkbox",disabled:"",id:"r_"+t.id+"_p_"+r.id}}):s("input",{staticClass:"custom-checkbox",attrs:{type:"checkbox",checked:"",disabled:"",id:"r_"+t.id+"_p_"+r.id}})])])}))],2)}))],2)]:e._e()],2),e._v(" "),e.hasPermission(e.user,e.PERMISSION_NAME.UPDATE_PERMISSIONS)?s("div",{staticClass:"col-12 text-right pr-0 mt-3"},[s("b-button",{staticClass:"btn btn-action",attrs:{size:"md",variant:"secondary"},on:{click:function(t){return e.reload()}}},[s("span",{staticClass:"text-white"},[e._v("Reload")])]),e._v(" "),s("b-button",{staticClass:"btn btn-action",attrs:{size:"md",variant:"success"},on:{click:function(t){return e.applyPermissions()}}},[s("span",{staticClass:"text-white"},[e._v("Apply")])])],1):e._e()])],1)}),[],!1,null,null,null);t.default=c.exports},X5Ec:function(e,t,s){(e.exports=s("I1BE")(!1)).push([e.i,"\n.grid-container {\r\n    display: grid; /* This is a (hacky) way to make the .grid element size to fit its content */\r\n    overflow: auto;\r\n    min-height: 100%;\r\n    max-height: calc(100vh - 298px - 6rem);\r\n    width: 100%;\n}\n.grid {\r\n    display: flex;\r\n    flex-wrap: nowrap;\n}\n.grid-col {\r\n    width: 160px;\r\n    min-width: 160px;\n}\n.grid-item--permission-name {\r\n    font-weight: bolder;\n}\n.grid-item--permission-name p {\r\n     text-overflow: ellipsis;\r\n     white-space: nowrap;\r\n     overflow: hidden;\n}\n.grid-item--role-name {\r\n    z-index: 1;\r\n    height: 50px;\r\n    min-height: 50px;\r\n    position: sticky;\r\n    position: -webkit-sticky;\r\n    background: white;\r\n    top: 0;\r\n    font-weight: bolder;\n}\n.grid-col--fixed-left {\r\n    position: -webkit-sticky;\r\n    position: sticky;\r\n    left: 0;\r\n    z-index: 1000;\r\n    background: white;\n}\n.grid-col--fixed-right {\r\n    position: -webkit-sticky;\r\n    position: sticky;\r\n    right: 0;\r\n    z-index: 1000;\r\n    background: white;\n}\n.grid-item {\r\n    height: 50px;\r\n    border: 1px solid gray;\n}\n.custom-checkbox {\r\n    width: 100%;\r\n    height: 30px;\n}\r\n",""])},"q+Me":function(e,t,s){"use strict";var r=s("+4bS");s.n(r).a}}]);